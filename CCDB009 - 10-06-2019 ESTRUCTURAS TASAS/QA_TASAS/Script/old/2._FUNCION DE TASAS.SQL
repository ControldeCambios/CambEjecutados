CREATE OR REPLACE FUNCTION FITBANK.TASAS(PCSUBSISTEMA IN VARCHAR2, PCGRUPOPRODUCTO IN NUMBER, PCPRODUCTO IN NUMBER, PMONTO IN NUMBER) RETURN NUMBER IS
    VTASA NUMBER(5,2);
BEGIN
    BEGIN
        SELECT SUM(NVL(MARGEN, 0))
        INTO VTASA
        FROM FITBANK.TPRODUCTOTASAS
        WHERE CPERSONA_COMPANIA= 2
        AND CSUBSISTEMA= PCSUBSISTEMA
        AND CGRUPOPRODUCTO = PCGRUPOPRODUCTO 
        AND CPRODUCTO = PCPRODUCTO 
        AND PMONTO BETWEEN MONTOMINIMO AND MONTOMAXIMO
        AND FHASTA = TO_DATE('31/12/2999','dd/mm/yyyy');
    EXCEPTION
        WHEN OTHERS THEN 
            VTASA := 0;
    END;
    RETURN VTASA; 
END;

COMMIT;
 